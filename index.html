<!doctypehtml><html lang=ja><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"name=viewport><title>Chat-K | Ver 0.1.1d</title><style>:root{--accent:#007AFF;--bg:#F2F2F7;--card-bg:#FFFFFF;--text:#000000;--header-bg:rgba(255,255,255,.9);--bubble-me:#007AFF;--bubble-other:#E9E9EB;--danger:#FF3B30;--border:rgba(0,0,0,.1);--neon-glow:transparent}body.neon-mode{--accent:#00f2ff;--bg:#0a0b10;--card-bg:#161821;--text:#fff;--header-bg:rgba(10,11,16,.85);--bubble-me:linear-gradient(135deg,#007AFF,#00f2ff);--bubble-other:#252836;--border:rgba(0,242,255,.3);--neon-glow:0 0 10px rgba(0,242,255,.2)}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:-apple-system,sans-serif}body{margin:0;background:var(--bg);color:var(--text);overflow:hidden;position:fixed;width:100%;height:100%;transition:.3s}#chat-area,.modal{scrollbar-width:none;-ms-overflow-style:none}#chat-area::-webkit-scrollbar,.modal::-webkit-scrollbar{display:none}header{backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);background:var(--header-bg);height:60px;display:flex;align-items:center;padding:env(safe-area-inset-top) 15px 0;border-bottom:1px solid var(--border);z-index:2000;position:relative;box-shadow:var(--neon-glow)}header button{background:0 0;border:none;font-size:22px;color:inherit;padding:10px;cursor:pointer}.title{flex:1;text-align:center;font-weight:600;font-size:17px}#chat-area{height:calc(100% - 60px);overflow-y:auto;padding:20px 15px 140px;display:flex;flex-direction:column;gap:15px}.footer{position:fixed;bottom:0;left:0;width:100%;background:var(--header-bg);backdrop-filter:blur(20px);padding:10px 15px calc(15px + env(safe-area-inset-bottom));display:none;gap:10px;border-top:1px solid var(--border);z-index:2500;align-items:center}.card{background:var(--card-bg);border-radius:16px;padding:20px;margin-bottom:15px;border:1px solid var(--border);box-shadow:var(--neon-glow)}.btn-main{width:100%;height:50px;background:var(--accent);color:#fff;border:none;border-radius:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:space-between;padding:0 20px;margin-bottom:10px;box-shadow:var(--neon-glow)}.close-btn{width:34px;height:34px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center;cursor:pointer}.u-icon{width:38px;height:38px;border-radius:50%;background:#ccc;flex-shrink:0;overflow:hidden;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}.msg-row{display:flex;gap:10px;max-width:90%}.msg-row.me{align-self:flex-end;flex-direction:row-reverse}.bubble{padding:10px 15px;border-radius:18px;font-size:16px;background:var(--bubble-other);color:var(--text);border:.5px solid var(--border);word-break:break-all}.me .bubble{background:var(--bubble-me);color:#fff;border:none}.img-preview{width:100%;max-width:250px;border-radius:14px;cursor:pointer}.switch{position:relative;display:inline-block;width:50px;height:28px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px}.slider:before{position:absolute;content:"";height:22px;width:22px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--accent)}input:checked+.slider:before{transform:translateX(22px)}#viewer{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:5000;display:none;align-items:center;justify-content:center}.v-btn{background:rgba(255,255,255,.2);border:none;color:#fff;width:44px;height:44px;border-radius:50%;font-size:20px;cursor:pointer}</style><header><button onclick=goHome()>ğŸ </button><div id=head-title class=title>ãƒ›ãƒ¼ãƒ </div><button onclick=openSettings() style=visibility:hidden id=header-set-btn>âš™ï¸</button></header><div id=chat-area></div><div id=chat-footer class=footer><button onclick='document.getElementById("file-input").click()'style="background:0 0;border:none;font-size:26px">ğŸ“</button><input id=file-input type=file onchange=sendFile(this) style=display:none><textarea id=msg-input placeholder=ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸... style="flex:1;border:none;background:rgba(120,120,128,.12);padding:10px 15px;border-radius:20px;color:inherit;outline:0;font-size:16px;resize:none;max-height:100px"></textarea><button onclick=sendMessage() style=background:var(--accent);color:#fff;border:none;width:44px;height:44px;border-radius:50%;flex-shrink:0>â†‘</button></div><div id=main-modal class="modal active"><div style=padding-top:20px><div style=display:flex;align-items:center;gap:15px;cursor:pointer class=card onclick=openUserCard()><div id=home-icon-preview class=u-icon></div><div style=flex:1><b id=u-name-display>-</b><br><small id=u-id-display style=opacity:.5>@id</small></div><span>ğŸ‘¤</span></div><h3>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h3><div id=project-list></div><button onclick='showForm("create")'class=btn-main style=background:#34c759;margin-top:15px><span>ï¼‹ æ–°è¦ä½œæˆ</span></button><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><button onclick='showForm("join")'class=btn-main style=background:#8e8e93><span>IDå‚åŠ </span></button><button onclick='showForm("token")'class=btn-main style=background:#5856d6><span>ã‚³ãƒ¼ãƒ‰</span></button></div><div style=display:none;margin-top:15px class=card id=p-form><div style=display:flex;justify-content:space-between;align-items:center;margin-bottom:10px><h4 id=p-form-title style=margin:0>-</h4><button onclick='document.getElementById("p-form").style.display="none"'class=close-btn>âœ•</button></div><input id=p-id-input style=width:100%;padding:12px;margin-bottom:10px;border-radius:8px placeholder="åå‰ / ID"><input id=p-pw-input type=password style=width:100%;padding:12px;margin-bottom:10px;border-radius:8px placeholder=ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰><button onclick=execAction() class=btn-main><span>å®Ÿè¡Œ</span></button></div></div></div><div id=user-modal class=modal><div style=display:flex;justify-content:space-between;align-items:center><h2>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h2><button onclick='closeModal("user-modal")'class=close-btn>âœ•</button></div><div style=text-align:center class=card><div style="width:100px;height:100px;margin:0 auto 15px;font-size:40px"class=u-icon id=edit-icon-preview></div><button onclick='document.getElementById("icon-input").click()'class=btn-main style=background:#8e8e93><span>å†™çœŸã‚’å¤‰æ›´</span></button><input id=icon-input type=file onchange=previewIcon(this) style=display:none accept=image/*><input id=edit-name style="width:100%;padding:12px;margin-bottom:15px;border-radius:10px;border:1px solid #ccc"placeholder=åå‰><div style="display:flex;justify-content:space-between;align-items:center;margin:15px 0"><span>ãƒã‚ªãƒ³ãƒ¢ãƒ¼ãƒ‰</span><label class=switch><input id=neon-toggle type=checkbox onchange=toggleNeon(this.checked)><span class=slider></span></label></div><button onclick=updateUser() class=btn-main><span>ä¿å­˜</span></button></div></div><div id=settings-modal class=modal><div style=display:flex;justify-content:space-between;align-items:center><h2>è¨­å®š</h2><button onclick='closeModal("settings-modal")'class=close-btn>âœ•</button></div><div class=card><button onclick=copyInviteToken() class=btn-main style=background:#5856d6><span>ğŸ”— ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</span></button><button onclick=leaveGroup() class=btn-main style=background:var(--danger)><span>ğŸšª é€€ä¼š</span></button></div></div><div id=viewer><div style=position:absolute;top:40px;left:20px;right:20px;display:flex;justify-content:space-between><button onclick=downloadFromViewer() class=v-btn>ğŸ“¥</button><button onclick='document.getElementById("viewer").style.display="none"'class=v-btn>âœ•</button></div><img id=viewer-img src=""style=max-width:100%;max-height:100%;object-fit:contain></div><script type=module>import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import{getDatabase,ref,set,get,push,onValue,update,remove,serverTimestamp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";const config={apiKey:"AIzaSyC0LabfY8QcZgSFySBrF5Jj6xnKMbPXbZo",databaseURL:"https://my-chat-1d626-default-rtdb.firebaseio.com",projectId:"my-chat-1d626"};const app=initializeApp(config);const db=getDatabase(app);let myId=localStorage.getItem('chat_uid'),myName=localStorage.getItem('chat_name'),myIcon="",currentGid=null;let lastSeen=JSON.parse(localStorage.getItem('chat_last_seen')||"{}");window.toggleNeon=o=>{document.body.classList.toggle('neon-mode',o);localStorage.setItem('neon_enabled',o)};const draw=(e,u,n)=>{if(!e)return;if(u)e.innerHTML=`<img src="${u}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;else{e.innerHTML=n?n[0]:"?";e.style.background="var(--accent)"}};window.goHome=async()=>{currentGid=null;document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'));document.getElementById('main-modal').classList.add('active');document.getElementById('chat-footer').style.display="none";document.getElementById('header-set-btn').style.visibility="hidden";document.getElementById('head-title').innerText="ãƒ›ãƒ¼ãƒ ";const s=await get(ref(db,`v20_users/${myId}`));if(s.exists()){myName=s.val().name;myIcon=s.val().icon||""}document.getElementById('u-name-display').innerText=myName;document.getElementById('u-id-display').innerText="@"+myId;draw(document.getElementById('home-icon-preview'),myIcon,myName);const l=document.getElementById('project-list');l.innerHTML="";const gs=await get(ref(db,`v20_users/${myId}/myGroups`));if(gs.exists()){for(let g of Object.keys(gs.val())){const ms=await get(ref(db,`v20_groups/${g}/messages`));let c=0;if(ms.exists()){const t=lastSeen[g]||0;c=Object.values(ms.val()).filter(m=>m.time>t&&m.uid!==myId).length}const b=document.createElement('button');b.className="btn-main";b.innerHTML=`<span>${g.split('_')[0]}</span>${c?`<span style="background:var(--danger);padding:2px 8px;border-radius:10px;font-size:12px">ğŸ”´ ${c}</span>`:''}`;b.onclick=()=>window.enterChat(g);l.appendChild(b)}}};window.enterChat=async g=>{currentGid=g;document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'));document.getElementById('chat-footer').style.display="flex";document.getElementById('header-set-btn').style.visibility="visible";lastSeen[g]=Date.now();localStorage.setItem('chat_last_seen',JSON.stringify(lastSeen));const snap=await get(ref(db,`v20_groups/${g}`));if(snap.exists())document.getElementById('head-title').innerText=snap.val().name||g.split('_')[0];onValue(ref(db,`v20_groups/${g}/messages`),s=>{const a=document.getElementById('chat-area');a.innerHTML="";if(s.exists()){Object.values(s.val()).forEach(m=>{const r=document.createElement('div');const isMe=m.uid===myId;let con=m.text,isI=0;if(m.type==="file"){isI=/\.(jpg|jpeg|png|gif|webp)$/i.test(m.fileName);con=isI?`<img src="${m.data}" class="img-preview" onclick="openViewer('${m.data}','${m.fileName}')">`:`<div class="bubble" onclick="downloadFile('${m.data}','${m.fileName}')">ğŸ“„ ${m.fileName}</div>`}r.className=`msg-row ${isMe?'me':'other'}`;r.innerHTML=`<div class="u-icon">${(m.name||"?")[0]}</div><div class="${isI?'':'bubble'}">${con}</div>`;a.appendChild(r)})}a.scrollTop=a.scrollHeight})};window.sendMessage=()=>{const i=document.getElementById('msg-input');if(i.value&&currentGid){push(ref(db,`v20_groups/${currentGid}/messages`),{uid:myId,name:myName,text:i.value,type:"text",time:serverTimestamp()});i.value=""}};window.sendFile=i=>{const f=i.files[0];if(!f||!currentGid)return;const r=new FileReader();r.onload=e=>push(ref(db,`v20_groups/${currentGid}/messages`),{uid:myId,name:myName,type:"file",data:e.target.result,fileName:f.name,time:serverTimestamp()});r.readAsDataURL(f)};window.execAction=async()=>{const i=document.getElementById('p-id-input').value,p=document.getElementById('p-pw-input').value;if(!i)return;if(window.pMode==='create'){const g=i+"_"+Math.random().toString(36).substr(2,6);await set(ref(db,`v20_groups/${g}`),{name:i,pw:p,host:myId});await update(ref(db,`v20_users/${myId}/myGroups`),{[g]:true})}else{const s=await get(ref(db,'v20_groups'));let t=null;s.forEach(g=>{if(g.val().name===i&&g.val().pw===p)t=g.key});if(t)await update(ref(db,`v20_users/${myId}/myGroups`),{[t]:true})}window.goHome()};window.updateUser=async()=>{const n=document.getElementById('edit-name').value;await update(ref(db,`v20_users/${myId}`),{name:n,icon:window.tempIcon||myIcon});location.reload()};window.previewIcon=i=>{const r=new FileReader();r.onload=e=>{window.tempIcon=e.target.result;draw(document.getElementById('edit-icon-preview'),e.target.result,"")};r.readAsDataURL(i.files[0])};window.openSettings=()=>document.getElementById('settings-modal').classList.add('active');window.openUserCard=()=>document.getElementById('user-modal').classList.add('active');window.closeModal=id=>document.getElementById(id).classList.remove('active');window.showForm=m=>{window.pMode=m;document.getElementById('p-form').style.display="block";document.getElementById('p-form-title').innerText=m==='create'?'æ–°è¦':'å‚åŠ '};window.openViewer=(u,n)=>{document.getElementById('viewer-img').src=u;window.vF={u,n};document.getElementById('viewer').style.display='flex'};window.downloadFromViewer=()=>{const a=document.createElement('a');a.href=window.vF.u;a.download=window.vF.n;a.click()};window.downloadFile=(b,n)=>{const a=document.createElement('a');a.href=b;a.download=n;a.click()};window.onload=()=>{toggleNeon(localStorage.getItem('neon_enabled')==='true');if(myId)goHome()};</script></html>
