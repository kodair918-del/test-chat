<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Chat-K | Dark Edition</title>
    <style>
        :root {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --header-bg: rgba(0, 0, 0, 0.75);
            --text: #ffffff;
            --accent: #0A84FF;
            --secondary-text: #8E8E93;
            --bubble-me: #30D158;
            --bubble-other: #2c2c2e;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; 
            font-family: -apple-system, sans-serif; 
            height: 100vh; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            color: var(--text);
        }

        header { 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: var(--header-bg);
            height: 60px; 
            display: flex; 
            align-items: center; 
            padding: 0 20px; 
            z-index: 2000; 
            border-bottom: 0.5px solid #333;
            flex-shrink: 0;
            padding-top: env(safe-area-inset-top);
        }

        header .title { flex: 1; text-align: center; font-weight: 600; font-size: 17px; }
        header button { 
            background: none; border: none; color: var(--accent); 
            font-size: 24px; cursor: pointer; width: 44px; height: 44px;
        }

        .page { display: none; height: 100%; width: 100%; animation: fadeIn 0.2s ease-out; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { 
            background: var(--card-bg); 
            border-radius: 16px; 
            padding: 24px; 
            margin: 16px; 
        }

        .btn { 
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-weight: 600; cursor: pointer; font-size: 16px; margin-top: 12px;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #2c2c2e; color: white; }

        /* ãƒãƒ£ãƒƒãƒˆç”»é¢ */
        #chat-page.active { display: flex; flex-direction: column; }
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .bubble { 
            padding: 10px 16px; border-radius: 20px; 
            background: var(--bubble-other); max-width: 80%; 
            font-size: 16px; line-height: 1.4;
        }
        .bubble.me { 
            align-self: flex-end; background: var(--bubble-me); color: white; 
        }

        .footer { 
            background: var(--bg); padding: 10px 16px 30px; 
            display: flex; gap: 10px; border-top: 0.5px solid #333; align-items: center;
        }
        textarea { 
            flex: 1; border: none; background: #1c1c1e; padding: 12px 18px; 
            border-radius: 22px; outline: none; font-size: 16px; height: 44px; resize: none; color: white;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal { 
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 80%; 
            background: #1c1c1e; z-index: 3000; transition: 0.3s cubic-bezier(0, 0, 0.2, 1); 
            border-radius: 20px 20px 0 0; padding: 30px;
        }
        .modal.open { bottom: 0; }
    </style>
</head>
<body>

<header>
    <button onclick="nav('dash')">ğŸ </button>
    <div class="title" id="head-title">Home</div>
    <button onclick="openModal('set-modal')">âš™ï¸</button>
</header>

<div id="login-page" class="page active">
    <div style="text-align:center; padding:100px 30px;">
        <h1 style="font-size:40px; margin-bottom:10px;">Chat-K</h1>
        <p style="color:var(--secondary-text); margin-bottom:40px;">åå‰ã‚’å…¥åŠ›ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
        <input type="text" id="u-name-input" placeholder="ã‚ãªãŸã®åå‰" style="width:100%; padding:18px; border-radius:14px; border:1px solid #333; font-size:18px; background:#1c1c1e; color:white; outline:none;">
        <button class="btn btn-primary" onclick="doLogin()">ãƒãƒ£ãƒƒãƒˆã‚’å§‹ã‚ã‚‹</button>
    </div>
</div>

<div id="dash-page" class="page">
    <div class="card">
        <div style="font-size:12px; color:var(--accent); font-weight:bold; margin-bottom:4px;">USER</div>
        <div id="u-display" style="font-size:28px; font-weight:bold;">Name</div>
        <button class="btn btn-primary" style="margin-top:24px;" onclick="nav('chat')">ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã«å…¥ã‚‹</button>
    </div>
    
    <div class="card">
        <button class="btn btn-secondary" onclick="createGroup()">æ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ</button>
    </div>
</div>

<div id="chat-page" class="page">
    <div id="chat-area"></div>
    <div class="footer">
        <textarea id="msg-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"></textarea>
        <button onclick="sendMsg()" style="background:var(--accent); color:white; border:none; width:40px; height:40px; border-radius:50%; font-size:20px;">â†‘</button>
    </div>
</div>

<div id="set-modal" class="modal">
    <h2 style="margin-top:0;">è¨­å®š</h2>
    <div style="margin-top:30px;">
        <label style="font-size:12px; color:var(--secondary-text);">åå‰ã®å¤‰æ›´</label>
        <input type="text" id="set-name" style="width:100%; padding:16px; border-radius:12px; border:1px solid #333; margin:8px 0 20px; font-size:16px; background:#2c2c2e; color:white;">
        <button class="btn btn-primary" onclick="saveSet()">ä¿å­˜ã™ã‚‹</button>
        <button class="btn" style="color:#FF453A; background:none; margin-top:20px;" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
    <button class="btn btn-secondary" style="margin-top:20px;" onclick="closeModal('set-modal')">é–‰ã˜ã‚‹</button>
</div>

<script>
    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id + '-page').classList.add('active');
        document.getElementById('head-title').innerText = id === 'dash' ? 'ãƒ›ãƒ¼ãƒ ' : 'ãƒãƒ£ãƒƒãƒˆ';
        if(id === 'chat') {
            const area = document.getElementById('chat-area');
            area.scrollTop = area.scrollHeight;
        }
    }

    function openModal(id) { document.getElementById(id).classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }

    function doLogin() {
        const name = document.getElementById('u-name-input').value.trim();
        if(!name) return;
        localStorage.setItem('ck_name', name);
        updateUI(name);
        nav('dash');
    }

    function updateUI(name) {
        document.getElementById('u-display').innerText = name;
        document.getElementById('set-name').value = name;
    }

    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if(!inp.value.trim()) return;
        const div = document.createElement('div');
        div.className = "bubble me";
        div.innerText = inp.value;
        document.getElementById('chat-area').appendChild(div);
        document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
        inp.value = "";
    }

    function createGroup() {
        const g = prompt("ã‚°ãƒ«ãƒ¼ãƒ—å:");
        if(g) alert("ã€Œ" + g + "ã€ã‚’ä½œæˆã—ã¾ã—ãŸ");
    }

    function saveSet() {
        const n = document.getElementById('set-name').value.trim();
        if(n) {
            localStorage.setItem('ck_name', n);
            document.getElementById('u-display').innerText = n;
            closeModal('set-modal');
        }
    }

    function logout() {
        localStorage.removeItem('ck_name');
        location.reload();
    }

    window.onload = () => {
        const saved = localStorage.getItem('ck_name');
        if(saved) {
            updateUI(saved);
            nav('dash');
        }
    };
</script>
</body>
</html>
