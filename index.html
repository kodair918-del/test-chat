<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Chat-K | Next Gen</title>
    <style>
        :root {
            --accent: #007AFF; /* iOS Blue */
            --bg: #F2F2F7;
            --card-bg: rgba(255, 255, 255, 0.8);
            --text: #000000;
            --header-bg: rgba(255, 255, 255, 0.7);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            height: 100vh; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            color: var(--text);
        }

        /* „Ç¨„É©„ÇπË≥™ÊÑü„ÅÆ„Éò„ÉÉ„ÉÄ„Éº */
        header { 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: var(--header-bg);
            height: 60px; 
            display: flex; 
            align-items: center; 
            padding: 0 20px; 
            z-index: 2000; 
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
            flex-shrink: 0;
            padding-top: env(safe-area-inset-top);
        }

        header .title { flex: 1; text-align: center; font-weight: 600; font-size: 17px; }
        header button { 
            background: none; border: none; color: var(--accent); 
            font-size: 24px; cursor: pointer; width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
        }

        /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢ */
        .page { display: none; height: 100%; width: 100%; overflow-y: auto; padding-bottom: 100px; }
        .page.active { display: block; animation: fadeIn 0.3s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* „É¢„ÉÄ„É≥„Å™„Ç´„Éº„Éâ */
        .card { 
            background: var(--card-bg); 
            backdrop-filter: blur(10px);
            border-radius: 20px; 
            padding: 24px; 
            margin: 16px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 0.5px solid rgba(255,255,255,0.5);
        }

        .btn { 
            width: 100%; padding: 16px; border: none; border-radius: 14px; 
            font-weight: 600; cursor: pointer; font-size: 16px; margin-top: 12px;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:active { opacity: 0.8; transform: scale(0.98); }
        .btn-secondary { background: rgba(0,0,0,0.05); color: var(--accent); }

        /* „ÉÅ„É£„ÉÉ„Éà„Ç®„É™„Ç¢ */
        #chat-page.active { display: flex; flex-direction: column; background: #fff; padding: 0; }
        #chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        
        .bubble { 
            padding: 12px 16px; border-radius: 20px; 
            background: #E9E9EB; max-width: 75%; 
            font-size: 16px; line-height: 1.4;
        }
        .bubble.me { 
            align-self: flex-end; background: var(--accent); color: white; 
            border-bottom-right-radius: 4px;
        }

        /* ÈÄ≤Âåñ„Åó„ÅüÊï∞Â≠¶„ÉÑ„Éº„É´„Éê„Éº */
        .math-bar { 
            background: rgba(255,255,255,0.9); border-top: 0.5px solid #ddd;
            display: flex; overflow-x: auto; padding: 8px; gap: 8px;
        }
        .math-bar::-webkit-scrollbar { display: none; }
        .m-btn { 
            background: #fff; border: 0.5px solid #ccc; border-radius: 8px;
            padding: 8px 15px; min-width: 45px; font-size: 18px; font-family: serif;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* ÂÖ•Âäõ„Ç®„É™„Ç¢ */
        .footer { 
            background: #fff; padding: 10px 16px 30px; 
            display: flex; gap: 10px; border-top: 0.5px solid #ddd; align-items: center;
        }
        textarea { 
            flex: 1; border: none; background: #F2F2F7; padding: 12px 18px; 
            border-radius: 22px; outline: none; font-size: 16px; height: 44px; resize: none;
        }

        /* „Éè„Éº„Éï„É¢„Éº„ÉÄ„É´ */
        .modal { 
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 90%; 
            background: #fff; z-index: 3000; transition: 0.4s cubic-bezier(0.25, 0.1, 0.25, 1); 
            border-radius: 30px 30px 0 0; padding: 30px; box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
        }
        .modal.open { bottom: 0; }
        .modal-handle { width: 40px; height: 5px; background: #ddd; border-radius: 10px; margin: -15px auto 20px; }
    </style>
</head>
<body>

<header>
    <button onclick="nav('dash')">üè†</button>
    <div class="title" id="head-title">Home</div>
    <button onclick="openModal('set-modal')">‚öôÔ∏è</button>
</header>

<div id="login-page" class="page active">
    <div style="text-align:center; padding:100px 30px;">
        <div style="font-size:60px; margin-bottom:20px;">üß™</div>
        <h1 style="margin:0; font-size:34px; letter-spacing:-1px;">Chat-K</h1>
        <p style="color:#8E8E93; margin-top:10px;">The Future of Science Chat</p>
        <div style="margin-top:40px;">
            <input type="email" id="u-email" placeholder="Email Address" style="width:100%; padding:18px; border-radius:16px; border:1px solid #ddd; font-size:16px; background:#fff;">
            <button class="btn btn-primary" onclick="doLogin()">Get Started</button>
        </div>
    </div>
</div>

<div id="dash-page" class="page">
    <div class="card">
        <div style="font-size:13px; color:var(--accent); font-weight:700; margin-bottom:5px;">LOGGED IN AS</div>
        <div id="u-display" style="font-size:24px; font-weight:700;">Guest User</div>
        <button class="btn btn-primary" style="margin-top:20px;" onclick="nav('chat')">üß™ Start Research Chat</button>
    </div>
    
    <div class="card">
        <h3 style="margin:0 0 15px;">Projects</h3>
        <button class="btn btn-secondary" onclick="createGroup()">Ôºã Create New Group</button>
    </div>
</div>

<div id="chat-page" class="page">
    <div id="chat-area"></div>
    <div class="math-bar">
        <button class="m-btn" onclick="ins('¬≤')">x¬≤</button>
        <button class="m-btn" onclick="ins('‚àö')">‚àö</button>
        <button class="m-btn" onclick="ins('œÄ')">œÄ</button>
        <button class="m-btn" onclick="ins('Œ∏')">Œ∏</button>
        <button class="m-btn" onclick="ins('¬±')">¬±</button>
        <button class="m-btn" onclick="ins('√∑')">√∑</button>
        <button class="m-btn" onclick="ins('‚àû')">‚àû</button>
        <button class="m-btn" onclick="ins('‚à´')">‚à´</button>
        <button class="m-btn" onclick="ins('Œª')">Œª</button>
    </div>
    <div class="footer">
        <textarea id="msg-input" placeholder="Aa"></textarea>
        <button onclick="sendMsg()" style="background:var(--accent); color:white; border:none; width:40px; height:40px; border-radius:50%; font-size:18px;">‚Üë</button>
    </div>
</div>

<div id="set-modal" class="modal">
    <div class="modal-handle"></div>
    <button onclick="closeModal('set-modal')" style="float:right; border:none; background:none; color:var(--accent); font-size:16px; font-weight:600;">Done</button>
    <h2 style="margin-top:0;">Settings</h2>
    <div style="margin-top:30px;">
        <label style="font-size:13px; color:#8E8E93; margin-left:10px;">DISPLAY NAME</label>
        <input type="text" id="set-name" style="width:100%; padding:16px; border-radius:14px; border:1px solid #ddd; margin:8px 0 20px; font-size:16px;">
        <button class="btn btn-primary" onclick="saveSet()">Update Profile</button>
        <button class="btn" style="color:#FF3B30; background:none; margin-top:20px;" onclick="logout()">Sign Out</button>
    </div>
</div>

<script>
    function nav(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id + '-page').classList.add('active');
        document.getElementById('head-title').innerText = id === 'dash' ? 'Home' : 'Research';
        if(id === 'chat') {
            const area = document.getElementById('chat-area');
            area.scrollTop = area.scrollHeight;
        }
    }

    function openModal(id) { document.getElementById(id).classList.add('open'); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }

    function ins(val) {
        const inp = document.getElementById('msg-input');
        const start = inp.selectionStart;
        inp.value = inp.value.substring(0, start) + val + inp.value.substring(inp.selectionEnd);
        inp.focus();
        inp.setSelectionRange(start + val.length, start + val.length);
    }

    function doLogin() {
        const email = document.getElementById('u-email').value;
        if(!email) return;
        localStorage.setItem('ck_v7_user', email);
        updateUI(email);
        nav('dash');
    }

    function updateUI(email) {
        const name = email.split('@')[0];
        document.getElementById('u-display').innerText = name;
        document.getElementById('set-name').value = name;
    }

    function sendMsg() {
        const inp = document.getElementById('msg-input');
        if(!inp.value.trim()) return;
        const div = document.createElement('div');
        div.className = "bubble me";
        div.innerText = inp.value;
        document.getElementById('chat-area').appendChild(div);
        document.getElementById('chat-area').scrollTop = document.getElementById('chat-area').scrollHeight;
        inp.value = "";
    }

    function createGroup() {
        const g = prompt("Project Name:");
        if(g) alert("Project '" + g + "' created!");
    }

    function saveSet() {
        const n = document.getElementById('set-name').value;
        document.getElementById('u-display').innerText = n;
        closeModal('set-modal');
    }

    function logout() {
        localStorage.removeItem('ck_v7_user');
        location.reload();
    }

    window.onload = () => {
        const saved = localStorage.getItem('ck_v7_user');
        if(saved) {
            updateUI(saved);
            nav('dash');
        }
    };
</script>
</body>
</html>
